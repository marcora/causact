<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.25">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>causact</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="causact_files/libs/clipboard/clipboard.min.js"></script>
<script src="causact_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="causact_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="causact_files/libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="causact_files/libs/quarto-html/popper.min.js"></script>
<script src="causact_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="causact_files/libs/quarto-html/anchor.min.js"></script>
<link href="causact_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="causact_files/libs/quarto-html/quarto-syntax-highlighting-7b89279ff1a6dce999919e0e67d4d9ec.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="causact_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="causact_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="causact_files/libs/bootstrap/bootstrap-d6a003b94517c951b2d65075d42fb01b.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script src="causact_files/libs/quarto-diagram/mermaid.min.js"></script>
<script src="causact_files/libs/quarto-diagram/mermaid-init.js"></script>
<link href="causact_files/libs/quarto-diagram/mermaid.css" rel="stylesheet">
<link href="causact_files/libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">
<script src="causact_files/libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<script src="causact_files/libs/viz-1.8.2/viz.js"></script>
<link href="causact_files/libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet">
<script src="causact_files/libs/grViz-binding-1.0.11/grViz.js"></script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#representing-uncertainty" id="toc-representing-uncertainty" class="nav-link" data-scroll-target="#representing-uncertainty">Representing uncertainty</a></li>
  <li><a href="#joint-distributions-tell-you-everything" id="toc-joint-distributions-tell-you-everything" class="nav-link" data-scroll-target="#joint-distributions-tell-you-everything">Joint distributions tell you everything</a>
  <ul class="collapse">
  <li><a href="#joint-distributions" id="toc-joint-distributions" class="nav-link" data-scroll-target="#joint-distributions">Joint distributions</a></li>
  <li><a href="#marginal-distributions" id="toc-marginal-distributions" class="nav-link" data-scroll-target="#marginal-distributions">Marginal distributions</a></li>
  <li><a href="#conditional-distributions" id="toc-conditional-distributions" class="nav-link" data-scroll-target="#conditional-distributions">Conditional distributions</a></li>
  <li><a href="#limitations-of-joint-distributions" id="toc-limitations-of-joint-distributions" class="nav-link" data-scroll-target="#limitations-of-joint-distributions">Limitations of joint distributions</a></li>
  </ul></li>
  <li><a href="#graphical-models-tell-joint-distribution-stories" id="toc-graphical-models-tell-joint-distribution-stories" class="nav-link" data-scroll-target="#graphical-models-tell-joint-distribution-stories">Graphical models tell joint distribution stories</a></li>
  <li><a href="#bayesian-inference-on-graphical-models" id="toc-bayesian-inference-on-graphical-models" class="nav-link" data-scroll-target="#bayesian-inference-on-graphical-models">Bayesian inference on graphical models</a>
  <ul class="collapse">
  <li><a href="#building-a-graphical-model-of-the-real-world" id="toc-building-a-graphical-model-of-the-real-world" class="nav-link" data-scroll-target="#building-a-graphical-model-of-the-real-world">Building a graphical model of the real-world</a></li>
  <li><a href="#from-model-to-joint-distribution" id="toc-from-model-to-joint-distribution" class="nav-link" data-scroll-target="#from-model-to-joint-distribution">From model to joint distribution</a></li>
  <li><a href="#bayesian-updating-of-the-joint-distribution" id="toc-bayesian-updating-of-the-joint-distribution" class="nav-link" data-scroll-target="#bayesian-updating-of-the-joint-distribution">Bayesian updating of the joint distribution</a></li>
  </ul></li>
  <li><a href="#generative-dags-as-scientific-and-statistical-models" id="toc-generative-dags-as-scientific-and-statistical-models" class="nav-link" data-scroll-target="#generative-dags-as-scientific-and-statistical-models">Generative DAGs as scientific and statistical models</a>
  <ul class="collapse">
  <li><a href="#generative-dags" id="toc-generative-dags" class="nav-link" data-scroll-target="#generative-dags">Generative DAGs</a></li>
  <li><a href="#building-generative-models" id="toc-building-generative-models" class="nav-link" data-scroll-target="#building-generative-models">Building generative models</a></li>
  <li><a href="#representing-observed-data-with-fill-and-a-plate" id="toc-representing-observed-data-with-fill-and-a-plate" class="nav-link" data-scroll-target="#representing-observed-data-with-fill-and-a-plate">Representing observed data with fill and a plate</a></li>
  </ul></li>
  <li><a href="#computational-bayesian-inference-workflows" id="toc-computational-bayesian-inference-workflows" class="nav-link" data-scroll-target="#computational-bayesian-inference-workflows">Computational Bayesian inference workflows</a>
  <ul class="collapse">
  <li><a href="#getting-started-with-dag_foo-functions" id="toc-getting-started-with-dag_foo-functions" class="nav-link" data-scroll-target="#getting-started-with-dag_foo-functions">Getting started with <code>dag_foo()</code> functions</a></li>
  <li><a href="#four-steps-to-creating-graphical-models" id="toc-four-steps-to-creating-graphical-models" class="nav-link" data-scroll-target="#four-steps-to-creating-graphical-models">Four steps to creating graphical models</a></li>
  <li><a href="#running-bayesian-inference-on-a-generative-dag" id="toc-running-bayesian-inference-on-a-generative-dag" class="nav-link" data-scroll-target="#running-bayesian-inference-on-a-generative-dag">Running Bayesian inference on a generative DAG</a></li>
  <li><a href="#investigating-the-posterior-distribution" id="toc-investigating-the-posterior-distribution" class="nav-link" data-scroll-target="#investigating-the-posterior-distribution">Investigating the posterior distribution</a></li>
  <li><a href="#making-probabilistic-statements-with-indicator-functions" id="toc-making-probabilistic-statements-with-indicator-functions" class="nav-link" data-scroll-target="#making-probabilistic-statements-with-indicator-functions">Making probabilistic statements with indicator functions</a></li>
  <li><a href="#credit-card-example" id="toc-credit-card-example" class="nav-link" data-scroll-target="#credit-card-example">Credit card example</a></li>
  </ul></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">causact</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggformula)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mosaic)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(posterior)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(bayesplot)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(causact) <span class="co"># causact::install_causact_deps()</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_set</span>(<span class="fu">theme_minimal</span>())</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>There are three languages at the core of any data analysis: narrative, math, and code.</p>
<ul>
<li><p><strong>Narrative</strong>: This is the language of your real-world understanding.</p></li>
<li><p><strong>Math</strong>: This is the language describing a faithful mathematical representation of your real-world narrative whose solution or output might turn your data into data-driven insight.</p></li>
<li><p><strong>Code</strong>: This is the programming language, the code required to generate output that exactly or approximately solves your math problem or generates the desired output.</p></li>
</ul>
<p>Using Bayesian inference is the provably best method of combining data with domain knowledge to extract interpretable and insightful results that lead us towards better outcomes.</p>
<p>This is the job of the <em>business analyst</em>; to drive better outcomes by compelling actions that are aligned with strategy and informed by data.</p>
<p><img src="images/clipboard-2076919182.png" class="img-fluid"></p>
<p><img src="images/clipboard-613416536.png" class="img-fluid"></p>
<p>The business analyst workflow consists of transforming the real-world into a compact mathematical representation that we can use, along with data, to computationally search for insights. These computational insights must then be translated back into the real-world in such a way that they inspire action which leads to improved outcomes. This is your role: transform the real-world into the math/computer world, extract mathematical/statistical/computational insight, then transform that insight into a compelling real-world call for action.</p>
<p><img src="images/clipboard-3434935492.png" class="img-fluid"></p>
</section>
<section id="representing-uncertainty" class="level2">
<h2 class="anchored" data-anchor-id="representing-uncertainty">Representing uncertainty</h2>
<p><span class="smallcaps">Real-world uncertainty</span> makes decision making hard. Conversely, without uncertainty decisions would be easier. For example, if a cafe knew exactly 10 customers would want a bagel, then they could make exactly 10 bagels in the morning; if a factory’s machine could make each part exactly the same, then quality control to ensure the part’s fit could be eliminated; if a customer’s future ability to pay back a loan was known, then a bank’s decision to underwrite the loan would be quite simple.</p>
<p>In this section, we learn to represent our real-world uncertainty (e.g.&nbsp;demand for bagels, quality of a manufacturing process , or risk of loan default) in mathematical and computational terms. We start by defining the ideal mathematical way of representing uncertainty, namely by assigning a <em>probability distribution</em> to a <em>random variable</em>. Subsequently, we learn to describe our uncertainty in a <em>random variable</em> using <em>representative samples</em> as a pragmatic computational proxy to this mathematical ideal.</p>
<p>Think of a random variable as a mapping from potential outcomes to numerical values representing the probability we assign to each outcome.</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Outcome</th>
<th>Probability</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Heads</td>
<td>0.5</td>
</tr>
<tr class="even">
<td>Tails</td>
<td>0.5</td>
</tr>
</tbody>
</table>
<p>While the table might be adequate to describe the mapping of coin flip outcomes to probability, as we make more complex models of the real-world, we will want to take advantage of the concise (and often terse) notation that mathematicians would use. In addition, we want to gain fluency in <em>math world</em> notation so that we can successfully traverse the bridge between <em>real world</em> and <em>math world</em>.</p>
<p>Above, a random variable was introduced as a mapping of outcomes to probabilities. And, this is how you should think of it most of the time. However, to start gaining fluency in the math-world definition of a random variable, we will also view this mapping process as not just one mapping, but rather a sequence of two mappings: 1) the first mapping is actually the “true” probability-theory definition of a <strong>random variable</strong> - it maps all possible outcomes to real numbers, and 2) the second mapping, known as a <strong>probability distribution</strong> in probability theory, maps the numbers from the first mapping to real numbers representing how plausibility is allocated across all possible outcomes - we often think of this allocation as assigning probability to each outcome.</p>
<p>The terse math-world representation of a mapping process like this is denoted:</p>
<p><span class="math display">\[
X:\Omega \rightarrow \mathbb{R}
\]</span></p>
<p>, where you interpret it as “random variable <span class="math inline">\(X\)</span> maps each possible outcome in sample space omega to a real number.”</p>
<p>The second mapping process then assigns a probability distribution to the random variable. By convention, lowercase letters, e.g.&nbsp;<span class="math inline">\(x\)</span>, represent actual observed outcomes. We call <span class="math inline">\(x\)</span> the <em>realization</em> of random variable <span class="math inline">\(X\)</span> and define the mapping of outcomes to probability for every <span class="math inline">\(x \in X\)</span> (read as <span class="math inline">\(x\)</span> “in” <span class="math inline">\(X\)</span> and interpret it to mean “for each possible realization of random variable <span class="math inline">\(X\)</span>”).</p>
<p>In this book, we will use <span class="math inline">\(f\)</span>, to denote a function that maps each possible realization of a random variable to its corresponding plausibilty measure and use a subscript to disambiguate which random variable is being referred to when necessary. For the coin flip example:</p>
<p><span class="math display">\[
f_X: X \rightarrow [0,1]
\]</span></p>
<p>Despite all this fancy notation, for small problems it is sometimes the best course of action to think of a random variable as a lookup table as shown here:</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Outcome</th>
<th>Realization (<span class="math inline">\(x\)</span>)</th>
<th><span class="math inline">\(f(x)\)</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Heads</td>
<td>1</td>
<td>0.5</td>
</tr>
<tr class="even">
<td>Tails</td>
<td>0</td>
<td>0.5</td>
</tr>
</tbody>
</table>
<p>and where <span class="math inline">\(f(x)\)</span> can be interpreted as the plausability assigned to random variable <span class="math inline">\(X\)</span> taking on the value <span class="math inline">\(x\)</span>.</p>
<p>The Bernoulli distribution (or a Bernoulli random variable):</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Outcome</th>
<th>Realization (<span class="math inline">\(x\)</span>)</th>
<th><span class="math inline">\(f(x)\)</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Success</td>
<td>1</td>
<td><span class="math inline">\(\pi\)</span></td>
</tr>
<tr class="even">
<td>Failure</td>
<td>0</td>
<td><span class="math inline">\(1-\pi\)</span></td>
</tr>
</tbody>
</table>
<p>With all of this background, we are now equipped to model uncertainty in any observable data that has two outcomes. The way we will represent this uncertainty is using two forms: 1) a graphical model and 2) a statistical model.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dag_create</span>() <span class="sc">|&gt;</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dag_node</span>(</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">descr =</span> <span class="st">"Coin flip"</span>,</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> <span class="st">"X"</span>) <span class="sc">|&gt;</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dag_render</span>(<span class="at">shortLabel =</span> <span class="cn">TRUE</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div class="grViz html-widget html-fill-item" id="htmlwidget-2ae4f30d7598595affc4" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-2ae4f30d7598595affc4">{"x":{"diagram":"digraph {\n\ngraph [layout = \"dot\",\n       outputorder = \"edgesfirst\",\n       bgcolor = \"white\",\n       labelloc = \"b\",\n       labeljust = \"r\"]\n\nnode [fontname = \"Helvetica\",\n      fontsize = \"10\",\n      shape = \"ellipse\",\n      fixedsize = \"false\",\n      width = \"0.9\",\n      style = \"filled\",\n      fillcolor = \"AliceBlue\",\n      color = \"gray20\",\n      fontcolor = \"black\",\n      height = \"0.5\",\n      margin = \"0.05,0.05\"]\n\nedge [fontname = \"Helvetica\",\n     fontsize = \"8\",\n     len = \"1.5\",\n     color = \"gray20\",\n     arrowsize = \"0.5\",\n     fontcolor = \"black\"]\n\n  \"1\" [label = \"Coin flip\", shape = \"ellipse\", peripheries = \"1\", fillcolor = \"aliceblue\", fontcolor = \"black\"] \n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p><span class="math display">\[
\begin{aligned}X &amp;\equiv \textrm{Coin flip outcome with heads}=1 \textrm{  and tails}=0.\\X &amp;\sim \textrm{Bernoulli}(p)\end{aligned}
\]</span></p>
<p>Instead of working with probability distributions directly as <em>mathematical</em> objects, we will most often seek a representative sample and treat them as <em>computational</em> objects (i.e.&nbsp;<strong>data</strong>). For modelling a coin flip, the representative sample might simply be a list of <span class="math inline">\(0\)</span> and <span class="math inline">\(1\)</span> generated by someone flipping a coin or by a computer simulating someone flipping a coin.</p>
<p><span class="smallcaps">Turning a mathematical object into a representative sample using R</span> is quite easy as R can be used to generate random outcomes from just about all well-known probability distributions.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rbern</span>(<span class="dv">7</span>, <span class="at">p =</span> <span class="fl">0.5</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1 0 1 0 1 1 0</code></pre>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>) </span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create dataframe of coinflip observations</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>numFlips <span class="ot">=</span> <span class="dv">50</span> <span class="do">## flip the coin 50 times</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> <span class="fu">data.frame</span>(</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">flipNum =</span> <span class="dv">1</span><span class="sc">:</span>numFlips,</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">coinFlip =</span> <span class="fu">rbern</span>(<span class="at">n=</span>numFlips,<span class="at">prob=</span><span class="fl">0.5</span>)</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">headsProportion =</span> <span class="fu">cummean</span>(coinFlip))</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot results</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x =</span> flipNum, <span class="at">y =</span> headsProportion)) <span class="sc">+</span> </span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span> </span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fl">0.5</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Running Proportion of Heads"</span>) <span class="sc">+</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Flip Number"</span>) <span class="sc">+</span> </span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Proportion of Heads"</span>) <span class="sc">+</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="causact_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><span class="math display">\[
\begin{aligned}X_i &amp;\equiv \textrm{If passenger } i \textrm{ shows up, then } X=1 \textrm{. Otherwise, } X = 0 \textrm{. Note: } i \in \{1,2,3\}.\\X_i &amp;\sim \textrm{Bernoulli}(p = 0.85)\\Y &amp;\equiv \textrm{Total number of passengers that show up.}\\Y &amp;= X_1 + X_2 + X_3\end{aligned}
\]</span></p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>numFlights <span class="ot">=</span> <span class="dv">1000</span> <span class="do">## number of simulated flights</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>probShow <span class="ot">=</span> <span class="fl">0.85</span> <span class="do">## probability of passenger showing up</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="co"># choose random seed so others can</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="co"># replicate results</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">111</span>) </span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>pass1 <span class="ot">=</span> <span class="fu">rbern</span>(<span class="at">n =</span> numFlights, <span class="at">prob =</span> probShow)</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>pass2 <span class="ot">=</span> <span class="fu">rbern</span>(<span class="at">n =</span> numFlights, <span class="at">prob =</span> probShow)</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>pass3 <span class="ot">=</span> <span class="fu">rbern</span>(<span class="at">n =</span> numFlights, <span class="at">prob =</span> probShow)</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="co"># create data frame (use tibble to from tidyverse) </span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>flightDF <span class="ot">=</span> <span class="fu">tibble</span>(</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">simNum =</span> <span class="dv">1</span><span class="sc">:</span>numFlights,</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">totalPassengers =</span> pass1 <span class="sc">+</span> pass2 <span class="sc">+</span> pass3</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a><span class="co"># transform data to give proportion</span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>propDF <span class="ot">=</span> flightDF <span class="sc">%&gt;%</span> </span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(totalPassengers) <span class="sc">%&gt;%</span> </span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">numObserved =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">proportion =</span> numObserved <span class="sc">/</span> <span class="fu">sum</span>(numObserved))</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a><span class="co"># plot data with estimates</span></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(propDF, </span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> totalPassengers, <span class="at">y =</span> proportion)) <span class="sc">+</span></span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>() <span class="sc">+</span></span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> proportion), <span class="at">nudge_y =</span> <span class="fl">0.03</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="causact_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Simulation will always be your friend in the sense that if given enough time, a simulation will always give you results that approximate mathematical exactness. The only problem with this friend is it is sometimes slow to yield representative results. In these cases, sometimes mathematics provides a shortcut. The shortcut we study here is to define a probability distibution.</p>
<p><span class="math display">\[
\begin{aligned}Y &amp;\equiv \textrm{Total number of passengers that show up.}\\Y &amp;\sim \textrm{Binomial}(n = 3, p = 0.85)\end{aligned}
\]</span></p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># transform data to give proportion</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>propExactDF <span class="ot">=</span> <span class="fu">tibble</span>(<span class="at">totalPassengers =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">3</span>) <span class="sc">%&gt;%</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">proportion =</span> </span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>           <span class="fu">dbinom</span>(<span class="at">x =</span> totalPassengers,</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>                  <span class="at">size =</span> <span class="dv">3</span>,</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>                  <span class="at">prob =</span> <span class="fl">0.85</span>))</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="co"># plot data with estimates</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(propExactDF, <span class="fu">aes</span>(<span class="at">x =</span> totalPassengers, </span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>                        <span class="at">y =</span> proportion)) <span class="sc">+</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>() <span class="sc">+</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> proportion), </span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>            <span class="at">nudge_y =</span> <span class="fl">0.03</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="causact_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The above code is both simpler and faster than the approximation code run earlier. In addition, it gives exact results. Hence, when we can take mathematical shortcuts, we will to save time and reduce the uncertainty in our results introduced by approximation error.</p>
<p>Our representation of uncertainty takes place in three worlds: 1) the real-world - we use graphical models (i.e.&nbsp;ovals) to convey the story of uncertainty, 2) the math-world - we use statistical models to rigorously define how random outcomes are generated, and 3) the computation-world - we use R functions to answer questions about exact distributions and representative samples to answer questions when the exact distribution is unobtainable.</p>
</section>
<section id="joint-distributions-tell-you-everything" class="level2">
<h2 class="anchored" data-anchor-id="joint-distributions-tell-you-everything">Joint distributions tell you everything</h2>
<p>The most complete method of reasoning about sets of random variables is by having a <em>joint probability distribution</em>. A joint probability distribution, , assigns a probability value to all possible assignments or realizations of sets of random variables. The goal of this section is to 1) introduce you to the notation of joint probability distributions and 2) convince you that if you are given a joint probability distribution, then you would be able to answer some very useful questions using probability.</p>
<section id="joint-distributions" class="level3">
<h3 class="anchored" data-anchor-id="joint-distributions">Joint distributions</h3>
</section>
<section id="marginal-distributions" class="level3">
<h3 class="anchored" data-anchor-id="marginal-distributions">Marginal distributions</h3>
</section>
<section id="conditional-distributions" class="level3">
<h3 class="anchored" data-anchor-id="conditional-distributions">Conditional distributions</h3>
</section>
<section id="limitations-of-joint-distributions" class="level3">
<h3 class="anchored" data-anchor-id="limitations-of-joint-distributions">Limitations of joint distributions</h3>
<p><span class="smallcaps">Why don’t we just use joint probability distributions all the time?</span> Despite the expressive power of having a joint probability distribution, they are not that easy to directly construct due to the <em>curse of dimensionality</em>. As the number of random variables being considered in a dataset grows, the number of potential probability assignments grows too. Even in the era of big data, this curse of dimensionality still exists.Generally speaking, an exponential increase is required in the size of the dataset as each new descriptive feature is added.</p>
<p>Let’s assume we have <span class="math inline">\(n\)</span> random variables with each having <span class="math inline">\(k\)</span> values. Thus, the joint distribution requires <span class="math inline">\(k^n\)</span> probabilites. Even if <span class="math inline">\(k=2\)</span> and <span class="math inline">\(n=34\)</span>, this leads to 17,179,869,184 possibilities (over 17 billion). To make this concrete, a typical car purchase decision might easily look at 34 different variables (e.g.&nbsp;make, model, color, style, financing, etc.). So, to model this decision would require a very large joint distribution which actually dwarfs the amount of data that is available. As a point of comparison, well under 100 million motor vehicles were sold worldwide in 2019 - i.e.&nbsp;less than one data point per possible combination of features. Despite this “curse”, we will learn to get around it with more compact representations of joint distributions. These representations will require less data, but will still yield the power to answer queries of interest; just as if we had access to the full joint distribution.</p>
</section>
</section>
<section id="graphical-models-tell-joint-distribution-stories" class="level2">
<h2 class="anchored" data-anchor-id="graphical-models-tell-joint-distribution-stories">Graphical models tell joint distribution stories</h2>
<p>Graphical models serve as compact representations of joint probability distributions.</p>
<p>It’s okay to not draw a perfect model when you are first attacking a problem.</p>
<div class="cell" data-layout-align="default">
<div class="cell-output-display">
<div>
<p></p><figure class="figure"><p></p>
<div>
<pre class="mermaid mermaid-js">graph TD
    X[ X: It is raining ]
    Y[ Y: The curb is wet ]
    X --&gt; Y
</pre>
</div>
<p></p></figure><p></p>
</div>
</div>
</div>
<p>The diagram above is what mathematicians and computer scientists call a <em>graph</em>. To them, a <em>graph</em> is a set of related objects where the objects are called <em>nodes</em> and any pair of related nodes are known as an <em>edge</em>. For our purposes, a <em>node</em> is a visual depiction of a random variable (i.e.&nbsp;an oval) and the presence of a visible <em>edge</em> indicates a relationship between the connected random variables.</p>
<p>Our first vetting should be to ensure that nodes can be modelled as a random variable with each node representing a mapping of real-world outcomes to numerical values (see the “Representing uncertainty” section above).</p>
<p>Any variable we include in our models needs to be clearly defined and fulfill the requirements of a random variable; afterall, this is our key technique for representing the <em>real-world</em> in mathematical terms.</p>
<p>Mathematically, our goal is to have a joint distribution over the random variables of interest. Once we have that, we can answer any probability query we might have using marginal and conditional distributions (see the “Joint distributions tell you everything” section above).</p>
<p>For all but very simple models like the one above, a tabular representation of a joint distribution becomes unmanageable (computationally, cognitively, and statistically).</p>
<p>To overcome this, we use a different, more-compact structure - called a <em>Bayesian Network</em> (BN). Bayesian networks are compressed, easier-to-specify recipes for generating a full joint distribution. So, what is a BN? It is a type of <em>graph</em> (i.e.&nbsp;nodes and edges), specifically a <em>directed acyclic graph</em> (DAG), with the following requirements:</p>
<ol type="1">
<li><p>All nodes represent random variables. They are drawn using ovals. By convention, a constant is also considered a random variable.</p></li>
<li><p>All edges are pairs of random variables with a specified direction of ordering. By convention, the direction is from parent node to child node. While not always true, it is usually good to have edges reflecting a causal ordering. Edges are drawn using arrows where the tail originates from the parent and the tip points to a child.</p></li>
<li><p>Edges are uni-directional, they must only flow in one direction between any two nodes (i.e.&nbsp;<em>directed</em>).</p></li>
<li><p>The graph is <em>acyclic</em> meaning there are no cycles. In other words, if you were to put your finger on any node and trace a path following the direction of the edges, you would not be able to return to the starting node.</p></li>
<li><p>Any child node’s probability distribution will be expressed as conditional solely on its parents’ values, i.e.&nbsp;<span class="math inline">\(P(\text{child}\mid \text{parent(s)})\)</span>; this assumption is what enables more compact representations of joint distributions.</p></li>
</ol>
<p>The one edge, <span class="math inline">\(Y \rightarrow X\)</span>, means that our uncertainty in <span class="math inline">\(X\)</span> is measured using a probability function conditional on its parent - i.e.&nbsp;<span class="math inline">\(P(X|Y)\)</span>. Since there are no edges leading into <span class="math inline">\(Y\)</span>, it has no parents, its probability distribution is <span class="math inline">\(P(Y)\)</span> . With those two probabilities in place, we can recover the joint distribution, <span class="math inline">\(P(X,Y)\)</span>, based on the definition of conditional probability <span class="math inline">\(P(X,Y) = P(Y) \times P(X|Y)\)</span>.</p>
<p>If there are no edges between <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span>, then the joint distribution is recovered via <span class="math inline">\(P(X,Y)=P(X)\cdot P(Y)\)</span>. In this case, the two random variables are independent and that is not a model structure consistent with the scenario we are exploring. If the ordering of nodes for <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span> are reversed such that <span class="math inline">\(Y\)</span> is the parent of <span class="math inline">\(X\)</span>, then the joint distribution would be recovered via <span class="math inline">\(P(X,Y)=P(Y)\cdot P(X\mid Y)\)</span>. This math is not consistent with the story we are trying to tell. The story is that rain causes the curb to be wet, not the other way around.</p>
<p>The general rule for a probabilistic graphical model is that its joint distribution can be factored using the chain rule formula for DAGs where <span class="math inline">\(P(X_1, X_2, \ldots, X_n) = \prod_I P(X_i|Parents(X_i))\)</span>. Hence, to model any one random variable, we only have to model its relationship to its parents instead of modelling its relationship to all of the random variables included in the model.</p>
<p>See <a href="www.youtube.com/@mathematicalmonk">mathematicalmonk</a>’s youtube video on how joint distributions are compactly represented using DAGs here: <a href="https://youtu.be/3XysEf3IQN4" class="uri">https://youtu.be/3XysEf3IQN4</a>.</p>
</section>
<section id="bayesian-inference-on-graphical-models" class="level2">
<h2 class="anchored" data-anchor-id="bayesian-inference-on-graphical-models">Bayesian inference on graphical models</h2>
<p><em>Plausible reasoning</em> - an allocation of credibility/plausibility to all possible explanations of the observations.</p>
<p>Plausible reasoning in the math world is called Bayesian inference - a methodology for updating the credibility/plausibility of the various explanations in our mathematical representation of the world as more data becomes available.</p>
<p>Let’s walk through a hypothetical argument between two scientists as to the effect of a new drug on cognition in Alzheimer’s disease (AD).</p>
<p>Assume the two scientists have competing models for what effect the drug will have on the cognition of patients with AD:</p>
<ol type="1">
<li><p><em>The Optimist Model (Model1)</em> : This model is from a scientist who is very optimistic about the effect of the drug and argues that 70% of all patients will see at least a 5% increase in cognition.</p></li>
<li><p><em>The Pessimist Model (Model2)</em> : This model is from a scientist who is very pessimistic about the effect of the drug and argues that 20% of all patients will see at least a 5% increase in cognition.</p></li>
</ol>
<p>These two scientists recognize and respect their differing opinions - they agree to test the new drug in one patient. They hire you as a data analyst and ask you to make the decision as to whose model is more credible in light of the test’s results. Your job is to allocate credibility to the two competing models both before seeing the test results and after seeing the test results. Initially, you might not have any reason to favor one model over another, but as data is collected, your belief in whose model is more plausible/believable/credible will change. For example, if cognition decreases, then the pessimist model would seem more credible. Your task is to allocate credibility (using probability theory) to the various models/explanations, before and after the data becomes available.</p>
<section id="building-a-graphical-model-of-the-real-world" class="level3">
<h3 class="anchored" data-anchor-id="building-a-graphical-model-of-the-real-world">Building a graphical model of the real-world</h3>
<p>The first step is to create a graphical model/representation of the real world.</p>
<p>Starting simple, <em>let’s only imagine that we test the drug in one patient</em> and our single data point (i.e.&nbsp;whether cognition increases by at least 5% or not) follows a Bernoulli distribution.</p>
<p>The graphical model is simply:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dag_create</span>() <span class="sc">|&gt;</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dag_node</span>(</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">descr =</span> <span class="st">"Cognition increases"</span>,</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> <span class="st">"X"</span>) <span class="sc">|&gt;</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dag_render</span>(<span class="at">shortLabel =</span> <span class="cn">TRUE</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div class="grViz html-widget html-fill-item" id="htmlwidget-f25ab85bf888dc624719" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-f25ab85bf888dc624719">{"x":{"diagram":"digraph {\n\ngraph [layout = \"dot\",\n       outputorder = \"edgesfirst\",\n       bgcolor = \"white\",\n       labelloc = \"b\",\n       labeljust = \"r\"]\n\nnode [fontname = \"Helvetica\",\n      fontsize = \"10\",\n      shape = \"ellipse\",\n      fixedsize = \"false\",\n      width = \"0.9\",\n      style = \"filled\",\n      fillcolor = \"AliceBlue\",\n      color = \"gray20\",\n      fontcolor = \"black\",\n      height = \"0.5\",\n      margin = \"0.05,0.05\"]\n\nedge [fontname = \"Helvetica\",\n     fontsize = \"8\",\n     len = \"1.5\",\n     color = \"gray20\",\n     arrowsize = \"0.5\",\n     fontcolor = \"black\"]\n\n  \"1\" [label = \"Cognition increases\", shape = \"ellipse\", peripheries = \"1\", fillcolor = \"aliceblue\", fontcolor = \"black\"] \n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>And, the statistical model with the mathematical details is represented like this:</p>
<p><span class="math display">\[
\begin{aligned}X \equiv&amp; \textrm{ Cognition increases: } \\        &amp; \textrm{ If cognition increases more than 5}\% \textrm{, then }X=1 \textrm{ otherwise, }X=0.\\X \sim  &amp; \textrm{ Bernoulli}(\theta)\\\end{aligned}
\]</span></p>
<p>We have seen this model before when representing coin flips. Our data is analogous to heads or tails of a coin flip. The data will be reduced to a zero or one for each patient. If given <span class="math inline">\(\theta\)</span>, we could generate data using <code>rbern(n=1, prob=theta)</code>, but, we do not know <span class="math inline">\(\theta\)</span>; the reason we are looking at data is to answer the question: “what is <span class="math inline">\(\theta\)</span>?”</p>
<p>From the story above, <span class="math inline">\(\theta\)</span> can only take on two values. In the optimistic model <span class="math inline">\(\theta = 70\%\)</span> and in the pessimistic model <span class="math inline">\(\theta = 20\%\)</span>. So, we have two models of the world and are uncertain as to which one is more plausible. Without data, we have no reason to believe one scientist over another, so <span class="math inline">\(P(\theta=70\%)=50\%\)</span> and <span class="math inline">\(P(\theta=20\%)=50\%\)</span> - i.e.&nbsp;each scientist is equally likely to be correct. This is just like saying <span class="math inline">\(P(\text{model1})=P(\text{model2})=50\%\)</span>. Before any data is considered, this allocation of credibility assigning probability to all the models being considered is called the <em>prior</em>. The prior is the initial probability allocated among all the possible models.</p>
<p>See <a href="https://youtu.be/nCRTuwCdmP0" class="uri">https://youtu.be/nCRTuwCdmP0</a> for gaining some intuition about prior probabilities.</p>
<p>So now, we can more completely specify our data story using both a graphical and a statistical model with specified prior probabilities. The graphical model is now two ovals representing our uncertainty in the probability of success and the observed cognition increase (random variable math-labels for <span class="math inline">\(\Theta\)</span> and <span class="math inline">\(X\)</span> are included for extra clarity in connecting the graphical model and the statistical model):</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dag_create</span>() <span class="sc">|&gt;</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dag_node</span>(</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">descr =</span> <span class="st">"Cognition increases"</span>,</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> <span class="st">"X"</span>) <span class="sc">|&gt;</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dag_node</span>(</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">descr =</span> <span class="st">"Success probability"</span>,</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> <span class="st">"Θ"</span>,</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">child =</span> <span class="st">"X"</span>) <span class="sc">|&gt;</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dag_render</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div class="grViz html-widget html-fill-item" id="htmlwidget-06a988fdd2a34d502a66" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-06a988fdd2a34d502a66">{"x":{"diagram":"digraph {\n\ngraph [layout = \"dot\",\n       outputorder = \"edgesfirst\",\n       bgcolor = \"white\",\n       labelloc = \"b\",\n       labeljust = \"r\"]\n\nnode [fontname = \"Helvetica\",\n      fontsize = \"10\",\n      shape = \"ellipse\",\n      fixedsize = \"false\",\n      width = \"0.9\",\n      style = \"filled\",\n      fillcolor = \"AliceBlue\",\n      color = \"gray20\",\n      fontcolor = \"black\",\n      height = \"0.5\",\n      margin = \"0.05,0.05\"]\n\nedge [fontname = \"Helvetica\",\n     fontsize = \"8\",\n     len = \"1.5\",\n     color = \"gray20\",\n     arrowsize = \"0.5\",\n     fontcolor = \"black\"]\n\n  \"1\" [label = \"Cognition increases\nX\", shape = \"ellipse\", peripheries = \"1\", fillcolor = \"aliceblue\", fontcolor = \"black\"] \n  \"2\" [label = \"Success probability\nΘ\", shape = \"ellipse\", peripheries = \"1\", fillcolor = \"aliceblue\", fontcolor = \"black\"] \n\"2\"->\"1\" [style = \"solid\"] \n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>And, the statistical model is represented like this:</p>
<p><span class="math display">\[
\begin{aligned}
X \equiv&amp; \textrm{ Cognition increases: } \\
        &amp; \textrm{ If cognition increases more than 5} \% \textrm{, then }X=1 \textrm{ otherwise, }X=0.\\
X \sim  &amp; \textrm{ Bernoulli}(\theta)\\
\Theta \equiv&amp; \textrm{ Success probability: } \\
\end{aligned}
\]</span> <span class="math display">\[
\Theta \sim
\begin{array}{ccc}
  \textrm{Outcome } &amp; \textrm{ Realization }(\theta) &amp; f(\theta) \\
  \hline
  \textrm{Model1}  &amp; \textrm{   70}\% &amp; \textrm{  50}\% \\
  \textrm{Model2}  &amp; \textrm{   20}\% &amp; \textrm{  50}\% \\
\end{array}
\]</span></p>
<p>where the prior probability distribution for <span class="math inline">\(\Theta\)</span> is given in tabular form.</p>
<p>The graphical model and statistical model are two different ways of representing the same story. The graphical model is more visual and intuitive, while the statistical model is more precise and mathematical. Both are useful for different purposes, but both represents a generative model, i.e., a recipe for simulating real-world data observations. In this case, following the top-down flow of the graphical model, the recipe is:</p>
<ol type="1">
<li>Simulate a potential success probability by randomly picking, with equal probability, either the optimist or pessimist model.</li>
<li>Simulate a drug’s success by using the probability from (1) and generating a Bernoulli random variable with that probability of success.</li>
</ol>
<p>We can easily show how to simulate an observation by writing code for the recipe in R:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 1: Simulate a potential success probability</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>theta <span class="ot">=</span> <span class="fu">sample</span>(<span class="at">size =</span> <span class="dv">1</span>, <span class="at">x =</span> <span class="fu">c</span>(<span class="fl">0.7</span>, <span class="fl">0.2</span>), <span class="at">prob =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">0.5</span>))</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 2: Simulate a drug's success</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>x <span class="ot">=</span> <span class="fu">rbern</span>(<span class="at">n =</span> <span class="dv">1</span>, <span class="at">prob =</span> theta)</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>theta</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.7</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>x</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1</code></pre>
</div>
</div>
<p>Much of your subsequent work will use this notion of generative models as recipes. You will 1) <em>create generative models</em> that serve as skeleton recipes - recipes with named probability distributions and <strong>unknown</strong> parameters - for how real-world data arises, and 2) <em>inform models with data</em> by reallocating plausibility to the recipe parameters that are most consistent with the data.</p>
<p>A guiding principle for creating good generative models is that the generated data should mimic data that you, as a data analyst, believe is plausible. If the generative model outputs implausible data in high frequency, then your model is not capturing the essence of the underlying data story; your modelling assumptions will need work. When the generative model seems correct in the absence of data, then data can feed the updating process which sensibly reallocates prior probability so that model parameters that tend to generate data similar to the observed data are deemed more plausible.</p>
</section>
<section id="from-model-to-joint-distribution" class="level3">
<h3 class="anchored" data-anchor-id="from-model-to-joint-distribution">From model to joint distribution</h3>
<p>The graphical model shows that we have uncertainty about two related random variables: 1) <em>Success Probability</em> (<span class="math inline">\(\Theta\)</span>) <em>Cognition Increases</em> (<span class="math inline">\(X\)</span>). Our assumption - built into our prior - is that one of our two models, <span class="math inline">\(\theta = 20\%\)</span> or <span class="math inline">\(\theta = 70\%\)</span>, is correct.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>This implicit assumption that one of the considered generative models is correct is sometimes referred to as the <em>small world</em> assumption. See this comparison by Richard McElreath of <em>small world</em> versus <em>large world</em> highlighting the implications of this assumption: <a href="https://youtu.be/WFv2vS8ESkk" class="uri">https://youtu.be/WFv2vS8ESkk</a>.</p>
</div>
</div>
<p>We are also confident about what collecting data from one patient might yield: either a single <em>success</em> or a single <em>failure</em> in terms of the cognition increase. Prior to collecting data, there are four combinations of model and data that are potential truths. Each combination’s prior plausibility, represented by <span class="math inline">\(a\%\)</span>, <span class="math inline">\(b\%\)</span>, <span class="math inline">\(c\%\)</span> and <span class="math inline">\(d\%\)</span>, are elements of the table:</p>
<p><span class="math display">\[
\begin{array}{cc|cc}         &amp;                  &amp; \textrm{  Possible}                &amp; \textrm{Models  }                  \\         &amp;                  &amp; \theta = 70\% &amp; \theta = 20\% \\         \hline\textrm{Possible} &amp; \textit{Success} &amp; a\%   &amp; b\%                     \\\textrm{Data}     &amp; \textit{Failure} &amp; c\%   &amp; d\%\end{array}
\]</span></p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Simulate many samples from the generative model</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>samples <span class="ot">&lt;-</span> <span class="fu">map</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10000</span>, <span class="cf">function</span>(x) { theta <span class="ot">=</span> <span class="fu">sample</span>(<span class="at">size =</span> <span class="dv">1</span>, <span class="at">x =</span> <span class="fu">c</span>(<span class="fl">0.7</span>, <span class="fl">0.2</span>), <span class="at">prob =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">0.5</span>)); x <span class="ot">=</span> <span class="fu">rbinom</span>(<span class="at">size=</span><span class="dv">1</span>, <span class="at">n=</span><span class="dv">1</span>, <span class="at">prob=</span>theta); <span class="fu">tibble</span>(theta, x) }) <span class="sc">|&gt;</span> <span class="fu">list_rbind</span>()</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(samples)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">theta</th>
<th style="text-align: right;">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">0.7</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">0.2</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">0.2</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">0.2</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">0.2</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">0.7</td>
<td style="text-align: right;">1</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate joint probability distribution before seeing the data, and the marginal of theta (prior)</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>joint <span class="ot">&lt;-</span> samples <span class="sc">%&gt;%</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(theta, x) <span class="sc">%&gt;%</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">count =</span> <span class="fu">n</span>(), <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">p =</span> count <span class="sc">/</span> <span class="fu">sum</span>(count))</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>joint</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">theta</th>
<th style="text-align: right;">x</th>
<th style="text-align: right;">count</th>
<th style="text-align: right;">p</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">0.2</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">4000</td>
<td style="text-align: right;">0.4000</td>
</tr>
<tr class="even">
<td style="text-align: right;">0.2</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1025</td>
<td style="text-align: right;">0.1025</td>
</tr>
<tr class="odd">
<td style="text-align: right;">0.7</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1536</td>
<td style="text-align: right;">0.1536</td>
</tr>
<tr class="even">
<td style="text-align: right;">0.7</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3439</td>
<td style="text-align: right;">0.3439</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>joint <span class="sc">|&gt;</span> </span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(theta) <span class="sc">|&gt;</span> </span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">prior =</span> <span class="fu">sum</span>(p))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">theta</th>
<th style="text-align: right;">prior</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">0.2</td>
<td style="text-align: right;">0.5025</td>
</tr>
<tr class="even">
<td style="text-align: right;">0.7</td>
<td style="text-align: right;">0.4975</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tally</span>(<span class="sc">~</span> x <span class="sc">+</span> theta, <span class="at">data =</span> samples, <span class="at">format =</span> <span class="st">'proportion'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>   theta
x      0.2    0.7
  0 0.4000 0.1536
  1 0.1025 0.3439</code></pre>
</div>
</div>
</section>
<section id="bayesian-updating-of-the-joint-distribution" class="level3">
<h3 class="anchored" data-anchor-id="bayesian-updating-of-the-joint-distribution">Bayesian updating of the joint distribution</h3>
<p><span class="math display">\[
P(Model | Data) = \frac{P(Data|Model) \times P(Model)}{P(Data)}
\]</span></p>
<p>The above formula is called <em>Bayes’ Theorem</em> and it is the mathematical engine that drives Bayesian inference. It is a simple formula, but it is very powerful. It tells us how to update our beliefs about the plausibility of various models in light of new data. The formula has four components:</p>
<ol type="1">
<li><span class="math inline">\(P(Model | Data)\)</span>: This is the <em>posterior</em> probability of the model given the data. It is what we are trying to compute. It tells us how plausible each model is after seeing the data.</li>
<li><span class="math inline">\(P(Data|Model)\)</span>: This is the <em>likelihood</em> of the data given the model. It tells us how likely the observed data is under each model.</li>
<li><span class="math inline">\(P(Model)\)</span>: This is the <em>prior</em> probability of the model.</li>
<li><span class="math inline">\(P(Data)\)</span>: This is the <em>marginal likelihood</em> of the data. It is a normalizing constant that ensures the posterior probabilities sum to one.</li>
</ol>
<p>To use Bayes’ Theorem, we need to compute the likelihood of the data under each model. This is done using the probability distributions defined in our statistical model.</p>
<p>Assume we observe a success, i.e.&nbsp;the patient’s cognition increases by at least 5%. The likelihood of this data under each model is:</p>
<ul>
<li>Under Model1 (<span class="math inline">\(\theta = 70\%\)</span>): <span class="math inline">\(P(X=1|\theta=70\%) = 0.7\)</span></li>
<li>Under Model2 (<span class="math inline">\(\theta = 20\%\)</span>): <span class="math inline">\(P(X=1|\theta=20\%) = 0.2\)</span></li>
</ul>
<p>The marginal likelihood of the data is computed by summing the likelihoods weighted by the prior probabilities:</p>
<p><span class="math display">\[
P(Data) = P(X=1) = P(X=1|\theta=70\%) \times P(\theta=70\%) + P(X=1|\theta=20\%) \times P(\theta=20\%) = 0.7 \times 0.5 + 0.2 \times 0.5 = 0.45
\]</span> Now, we can plug these values into Bayes’ Theorem to compute the posterior probabilities:</p>
<ul>
<li>For Model1 (<span class="math inline">\(\theta = 70\%\)</span>):</li>
</ul>
<p><span class="math display">\[
P(\theta=70\%|X=1) = \frac{P(X=1|\theta=70\%) \times P(\theta=70\%)}{P(X=1)} = \frac{0.7 \times 0.5}{0.45} \approx 0.778
\]</span></p>
<ul>
<li>For Model2 (<span class="math inline">\(\theta = 20\%\)</span>):</li>
</ul>
<p><span class="math display">\[
P(\theta=20\%|X=1) = \frac{P(X=1|\theta=20\%) \times P(\theta=20\%)}{P(X=1)} = \frac{0.2 \times 0.5}{0.45} \approx 0.222
\]</span></p>
<p>So, after observing a success, the posterior probabilities are approximately 77.8% for Model1 and 22.2% for Model2. This means that after seeing the data, we believe that Model1 is more plausible than Model2.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate joint probability distribution after seeing the data (x=1), and the marginal of theta (posterior)</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>joint <span class="ot">&lt;-</span> samples <span class="sc">%&gt;%</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(x <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(theta, x) <span class="sc">%&gt;%</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">count =</span> <span class="fu">n</span>(), <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">p =</span> count <span class="sc">/</span> <span class="fu">sum</span>(count))</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>joint</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">theta</th>
<th style="text-align: right;">x</th>
<th style="text-align: right;">count</th>
<th style="text-align: right;">p</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">0.2</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1025</td>
<td style="text-align: right;">0.2296</td>
</tr>
<tr class="even">
<td style="text-align: right;">0.7</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3439</td>
<td style="text-align: right;">0.7704</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>joint <span class="sc">|&gt;</span> </span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(theta) <span class="sc">|&gt;</span> </span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">prior =</span> <span class="fu">sum</span>(p))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">theta</th>
<th style="text-align: right;">prior</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">0.2</td>
<td style="text-align: right;">0.2296</td>
</tr>
<tr class="even">
<td style="text-align: right;">0.7</td>
<td style="text-align: right;">0.7704</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section>
</section>
<section id="generative-dags-as-scientific-and-statistical-models" class="level2">
<h2 class="anchored" data-anchor-id="generative-dags-as-scientific-and-statistical-models">Generative DAGs as scientific and statistical models</h2>
<p>Up to this point, we specified a prior joint distribution using information from both a graphical model and a statistical model. In this section, we combine the two model types, graphical models and statistical models, into one visualization called the generative DAG.</p>
<p>The advantage of this is that the generative DAG unites real-world measurements (e.g.&nbsp;cognition increases) with their math/computation world counterparts (e.g.&nbsp;<span class="math inline">\(X \sim \textrm{Bernoulli}(\theta)\)</span>) without requiring the cognitive load of flipping back-and-forth between the graphical and statistical models.</p>
<p>Moreover, generative DAGs, when combined with data, enable Bayesian inference to be automated (yay! no more manual calculations using Bayes rule).</p>
<section id="generative-dags" class="level3">
<h3 class="anchored" data-anchor-id="generative-dags">Generative DAGs</h3>
<p>To build a generative DAG, we combine a graphical model with a <em>statistical model</em> into a single unifying representation.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>A statistical model is a mathematically expressed recipe for creating a joint distribution of related random variables. Each variable is defined either using a probability distribution or a function of the other variables. Statistical model and generative DAG will be used interchangeably. The term statistical model is just the mathematically expressed recipe. Generative DAG is the graphically expressed recipe with an embedded statistical model.</p>
</div>
</div>
<p>The objective in building generative DAGs is to capture how we might go about simulating real-world measurements using the mathematical language we’ve been learning. Good generative DAGs are recipes for simulating a real-world observation in a way that reflects our domain knowledge. Then, with a generative DAG and some actual data, we will ask the computer to do Bayesian inference for us and to output an updated joint distribution of the random variables in our DAG.</p>
<p>The creation of a generative DAG mimics the creation of graphical models with accompanying statistical models. Both the structure of the DAG and the definition of the random variables should reflect what a domain expert knows, or wants to assume, about the data generating process being investigated.</p>
<p>Here is the generative DAG for the scenario described before. We have seen some elements of this DAG before. For example, the <em>Cognition increase</em>s <span class="math inline">\(X\)</span> node, whose prominent feature is that it can only take on two-values, <em>yes</em> or <em>no</em>. We model these binary-valued real-world outcomes with the probabilistic mapping (Bernoulli PMF) <span class="math inline">\(x \sim \textrm{Bernoulli}(\theta)\)</span>.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dag_create</span>() <span class="sc">|&gt;</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dag_node</span>(</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">descr =</span> <span class="st">"Cognition increases"</span>,</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> <span class="st">"x"</span>,</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">rhs =</span> <span class="fu">bernoulli</span>(theta)) <span class="sc">|&gt;</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dag_node</span>(</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">descr =</span> <span class="st">"Success probability"</span>,</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> <span class="st">"theta"</span>,</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">child =</span> <span class="st">"x"</span>,</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">rhs =</span> <span class="fu">uniform</span>(<span class="dv">0</span>,<span class="dv">1</span>)) <span class="sc">|&gt;</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dag_render</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div class="grViz html-widget html-fill-item" id="htmlwidget-744b8e1fe96c0688a849" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-744b8e1fe96c0688a849">{"x":{"diagram":"digraph {\n\ngraph [layout = \"dot\",\n       outputorder = \"edgesfirst\",\n       bgcolor = \"white\",\n       labelloc = \"b\",\n       labeljust = \"r\"]\n\nnode [fontname = \"Helvetica\",\n      fontsize = \"10\",\n      shape = \"ellipse\",\n      fixedsize = \"false\",\n      width = \"0.9\",\n      style = \"filled\",\n      fillcolor = \"AliceBlue\",\n      color = \"gray20\",\n      fontcolor = \"black\",\n      height = \"0.5\",\n      margin = \"0.05,0.05\"]\n\nedge [fontname = \"Helvetica\",\n     fontsize = \"8\",\n     len = \"1.5\",\n     color = \"gray20\",\n     arrowsize = \"0.5\",\n     fontcolor = \"black\"]\n\n  \"1\" [label = \"Cognition increases\nx ~ bernoulli(theta)\", shape = \"ellipse\", peripheries = \"1\", fillcolor = \"aliceblue\", fontcolor = \"black\"] \n  \"2\" [label = \"Success probability\ntheta ~ uniform(0,1)\", shape = \"ellipse\", peripheries = \"1\", fillcolor = \"aliceblue\", fontcolor = \"black\"] \n\"2\"->\"1\" [style = \"solid\"] \n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>Other elements of the DAG are new. Notice, <code>theta</code> is now spelled out phonetically as opposed to using the actual Greek letter math symbol of <span class="math inline">\(\theta\)</span>. While this need not be done when drawing a generative DAG by hand, we phonetically spell out the Greek letter <span class="math inline">\(\theta\)</span> as <code>theta</code> here because computer code and computer-generated DAG visuals lack easy support for the Greek alphabet. Additionally, and more importantly, we switch to using lowercase notation for both <code>x</code> and <code>theta</code> as we want to highlight that ovals in generative DAG models represent a single realization of the random variable. Later we will introduce the representation of more than one realization.</p>
</section>
<section id="building-generative-models" class="level3">
<h3 class="anchored" data-anchor-id="building-generative-models">Building generative models</h3>
<p>As we build these generative DAGs, it is often easiest to build and read them from bottom to top; start by converting your target measurement, in this case whether the cognition of patients with AD increases after treatment with a new drug, to a brief real-world description (e.g.&nbsp;<em>Cognition increases</em>). This description is the top-line of the oval. For rigor, a more formal definition should be stored outside of the generative DAG in a simple text document that can be referenced by others.</p>
<p>Every node will also have a mathematical line (e.g.&nbsp;<span class="math inline">\(x \sim \textrm{Bernoulli}(theta)\)</span>). The mathematical line will always follow a three-part structure of 1) Left-hand side, 2) Relationship Type, and 3) Right-hand side:</p>
<p>Each line of a statistical model follows one of two forms: or</p>
<ul>
<li><p><strong>Left-hand side (LHS)</strong>: a mathematical label for a realization of the node (e.g.&nbsp;<span class="math inline">\(x\)</span> or <span class="math inline">\(y\)</span> or whatever symbol/word you choose). The purpose of the label is to have a very short way of referring to a node. To that end, you cannot include spaces in this label and try to keep it at five letters or less.</p></li>
<li><p><strong>Relationship Type</strong>: There are two types of relationships that can be specified:</p></li>
</ul>
<ol type="1">
<li><p>a <em>probabilistic</em> relationship, denoted by the <span class="math inline">\(\sim\)</span> symbol, where the LHS node’s value is determined with some uncertainty/randomness as a function of its inputs, such as the outcome of a coin flip. <span class="math inline">\(LHS \sim \textrm{Probability mass/density function}\)</span> Or,</p></li>
<li><p>a <em>deterministic</em> relationship denoted by an <span class="math inline">\(=\)</span> symbol. A deterministic relationship means the LHS node’s value is determined with zero uncertainty as a function of its inputs. <span class="math inline">\(LHS \sim \textrm{Deterministic function}\)</span></p></li>
</ol>
<ul>
<li><strong>Right-hand side (RHS)</strong>: either a known probability distribution (i.e., probability mass or density function) governing the node’s random outcome (e.g.&nbsp;<span class="math inline">\(\textrm{Bernoulli}(\theta)\)</span>) or a deterministic mathematical function defining the node’s value (e.g.&nbsp;<span class="math inline">\(x + y\)</span> ). In both cases, any parameters/variables/inputs in the RHS must be represented by a parent node to the current node in your model.</li>
</ul>
<p>To model subsequent nodes, consider any parameters or variables on the right-hand side of the mathematical lines that remain undefined; all of these undefined parameters must be defined on the LHS of a parent node. Hence, for <span class="math inline">\(x \sim \textrm{Bernoulli}(theta)\)</span>, <span class="math inline">\(\theta\)</span> should be (and is) the LHS of a parent node of <span class="math inline">\(x\)</span>.</p>
<p>Now to have a complete statistical model, we need a recipe for how all the random variables of interest can be generated. Previously, when doing Bayes rule calculations by hand, we considered a recipe for with only two possible values. However, as we move towards using the computer to do Bayesian inference for us, we now consider all of the possibilities - any value between 0 and 1.</p>
<p>The generative DAG above introduces us to the uniform distribution. The <span class="math inline">\(\textrm{uniform}(a, b)\)</span> distribution is a two-parameter probability distribution with the property that all real numbers between <span class="math inline">\(a\)</span> and <span class="math inline">\(b\)</span> are generated with equal probability. Hence, for our application where represents a probability restricted to be between 0 and 1, we use <span class="math inline">\(\textrm{uniform}(0, 1)\)</span> to represent our consideration of the infinite possible values of success probability ranging from 0% to 100%.</p>
<p>Since all nodes/variables (<span class="math inline">\(x\)</span> and <span class="math inline">\(\theta\)</span>) have a mathematical line, and all RHS parameters/variables are defined, the DAG above represents a generative model. The top line of each oval is a meaningful real-world description of the random variable and the bottom line gives the math.</p>
<p>Notice that the generative DAG is a recipe for simulating or generating a single sample/realization from the joint distribution - read it from top-to-bottom: 1) first, simulate a random sample value of <span class="math inline">\(\theta\)</span>, say the realization is 10%, and then 2) use that sample value to simulate <span class="math inline">\(x\)</span>, which assuming <span class="math inline">\(\theta = 10\%\)</span>, is either 0 with 90% probability or 1 with 10% probability.</p>
<p>For illustrating the simulation aspect of a generative DAG, we can use simple R functions to get a joint realization of the two variables. We model <span class="math inline">\(\theta\)</span> as <span class="math inline">\(\textrm{uniform}(0, 1)\)</span> and <span class="math inline">\(x\)</span> as <span class="math inline">\(\textrm{bernoulli}(\theta)\)</span> computationally using the functions <code>runif</code> and <code>rbern</code> (i.e.&nbsp;<code>rfoo</code> for the uniform distribution and Bernoulli distribution, respectively). Hence, a random sample from the joint distribution of <span class="math inline">\(\Theta\)</span> and <span class="math inline">\(X\)</span> can be generated with the following code:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="co"># generate random theta: n is # of samples we want</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>theta <span class="ot">=</span> <span class="fu">runif</span>(<span class="at">n=</span><span class="dv">1</span>,<span class="at">min=</span><span class="dv">0</span>,<span class="at">max=</span><span class="dv">1</span>)</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>theta <span class="co"># print value</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.1137</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># generate random X</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>x <span class="ot">=</span> <span class="fu">rbern</span>(<span class="at">n =</span> <span class="dv">1</span>, <span class="at">prob =</span> theta)</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>x <span class="co"># print value</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0</code></pre>
</div>
</div>
<p>For the particular model above, the recipe picked a random <span class="math inline">\(\theta\)</span> of 11.4% and then, using that small probability of success, generated a random <span class="math inline">\(x\)</span> with 11.4% chance of giving a one. Unsurprisingly, the random sample from <span class="math inline">\(x\)</span> was zero.</p>
<p>A generative models is a mathematical abstraction of a real-world data generating process (DGP); they represent, in the formal language of probability theory, our knowledge of the DGP. We will use these abstractions and Bayesian inference to combine prior information in the form of a generative DAG with observed data. The combination will yield us a posterior distribution; a joint distribution over our RV’s of interest that we can use to answer questions and generate insight. For most generative DAGs, Bayes rule is not analytically tractable (i.e.&nbsp;it can’t be reduced to simple math), and we need to define a computational model using a probabilistic programming language.</p>
</section>
<section id="representing-observed-data-with-fill-and-a-plate" class="level3">
<h3 class="anchored" data-anchor-id="representing-observed-data-with-fill-and-a-plate">Representing observed data with fill and a plate</h3>
<p>A generative DAG represents a family of recipes (i.e., hypothesis space, where each hypothesis/recipe is indexed by a parameter value or combination of parameter values) for simulating one real-world observation. We can then use data to inform us about which of the recipes seem more consistent with the data. For example, we know that observing cognition increase not in one but three patients with AD after drug treatment would be less consistent with the recipe based on the pessimist model <span class="math inline">\(\theta = 20\%\)</span> and more consistent with the recipe based on the optimist model <span class="math inline">\(\theta = 70\%\)</span>. Thus, reallocating plausibility in light of this type of data becomes a milestone during our data analysis.</p>
<p>In the generative DAG above, the reallocation of probability in light of the data will be done in such a way as to give more plausibility to <span class="math inline">\(\theta\)</span> values consistent with the observations and less plausibility to the other <span class="math inline">\(\theta\)</span> values.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dag_create</span>() <span class="sc">|&gt;</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dag_node</span>(</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">descr =</span> <span class="st">"Cognition increases"</span>,</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> <span class="st">"x"</span>,</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">rhs =</span> <span class="fu">bernoulli</span>(theta),</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">obs =</span> <span class="cn">TRUE</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dag_node</span>(</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">descr =</span> <span class="st">"Success probability"</span>,</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> <span class="st">"theta"</span>,</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">child =</span> <span class="st">"x"</span>,</span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">rhs =</span> <span class="fu">uniform</span>(<span class="dv">0</span>,<span class="dv">1</span>)) <span class="sc">|&gt;</span></span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dag_render</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div class="grViz html-widget html-fill-item" id="htmlwidget-169abb3486349adfa5d8" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-169abb3486349adfa5d8">{"x":{"diagram":"digraph {\n\ngraph [layout = \"dot\",\n       outputorder = \"edgesfirst\",\n       bgcolor = \"white\",\n       labelloc = \"b\",\n       labeljust = \"r\"]\n\nnode [fontname = \"Helvetica\",\n      fontsize = \"10\",\n      shape = \"ellipse\",\n      fixedsize = \"false\",\n      width = \"0.9\",\n      style = \"filled\",\n      fillcolor = \"AliceBlue\",\n      color = \"gray20\",\n      fontcolor = \"black\",\n      height = \"0.5\",\n      margin = \"0.05,0.05\"]\n\nedge [fontname = \"Helvetica\",\n     fontsize = \"8\",\n     len = \"1.5\",\n     color = \"gray20\",\n     arrowsize = \"0.5\",\n     fontcolor = \"black\"]\n\n  \"1\" [label = \"Cognition increases\nx ~ bernoulli(theta)\", shape = \"ellipse\", peripheries = \"1\", fillcolor = \"cadetblue\", fontcolor = \"black\"] \n  \"2\" [label = \"Success probability\ntheta ~ uniform(0,1)\", shape = \"ellipse\", peripheries = \"1\", fillcolor = \"aliceblue\", fontcolor = \"black\"] \n\"2\"->\"1\" [style = \"solid\"] \n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dag_create</span>() <span class="sc">|&gt;</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dag_node</span>(</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">descr =</span> <span class="st">"Cognition increases"</span>,</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> <span class="st">"x"</span>,</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">rhs =</span> <span class="fu">bernoulli</span>(theta),</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">obs =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dag_plate</span>(</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">descr =</span> <span class="st">"Observation"</span>,</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> <span class="st">"i"</span>,</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">nodeLabels =</span> <span class="st">"x"</span>) <span class="sc">|&gt;</span></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dag_node</span>(</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">descr =</span> <span class="st">"Success probability"</span>,</span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> <span class="st">"theta"</span>,</span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">child =</span> <span class="st">"x"</span>,</span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">rhs =</span> <span class="fu">uniform</span>(<span class="dv">0</span>,<span class="dv">1</span>)) <span class="sc">|&gt;</span></span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dag_render</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div class="grViz html-widget html-fill-item" id="htmlwidget-21dc44474b3e8cd160f8" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-21dc44474b3e8cd160f8">{"x":{"diagram":"digraph {\n\ngraph [layout = \"dot\",\n       outputorder = \"edgesfirst\",\n       bgcolor = \"white\",\n       labelloc = \"b\",\n       labeljust = \"r\"]\n\nnode [fontname = \"Helvetica\",\n      fontsize = \"10\",\n      shape = \"ellipse\",\n      fixedsize = \"false\",\n      width = \"0.9\",\n      style = \"filled\",\n      fillcolor = \"AliceBlue\",\n      color = \"gray20\",\n      fontcolor = \"black\",\n      height = \"0.5\",\n      margin = \"0.05,0.05\"]\n\nedge [fontname = \"Helvetica\",\n     fontsize = \"8\",\n     len = \"1.5\",\n     color = \"gray20\",\n     arrowsize = \"0.5\",\n     fontcolor = \"black\"]\n\n  \"2\" [label = \"Success probability\ntheta ~ uniform(0,1)\", shape = \"ellipse\", peripheries = \"1\", fillcolor = \"aliceblue\", fontcolor = \"black\"] \nsubgraph cluster2{\nlabel=\"Observation i\"\n  \"1\" [label = \"Cognition increases\nx ~ bernoulli(theta)\", shape = \"ellipse\", peripheries = \"1\", fillcolor = \"cadetblue\", fontcolor = \"black\"] }\n\n\"2\"->\"1\" [style = \"solid\"] \n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>In the generative DAG above, there are some additional elements. <em>Observed</em> data - in contrast to latent parameters/variables or unobserved data - gets represented by using fill shading of the ovals (e.g.&nbsp;the darker fill of <em>Cognition increases</em>). Also, rectangles called <em>plates</em> are used to indicate repetition of the enclosed random variable (or group/subgraph of random variables). In this case, the plate indicates we have observed multiple [modeled as independent in the corresponding statistical model] outcomes/realizations of <span class="math inline">\(x\)</span> from treating more than one patient with the drug.</p>
<p>Text in the lower right-hand corner of the plate indicates how variables inside the plate are repeated and indexed. In this case, there will be one realization of <span class="math inline">\(x\)</span> for each observation. The letter <span class="math inline">\(i\)</span> represents a short-hand label used to index the observations. For example, <code>x[i]</code> is the <span class="math inline">\(i^{\text{th}}\)</span> observation of <code>x</code> and therefore, <code>x[2]</code> would the <span class="math inline">\(2^{\text{nd}}\)</span> observation of <code>x</code>. The <code>[3]</code> in the lower-right hand corner represents the number of repetitions of the RV, in this case there are 3 observations of stores: <code>x[1]</code>, <code>x[2]</code>, and <code>x[3]</code>.</p>
<p>Since the <span class="math inline">\(\theta\)</span> node lacks a plate, the generative recipe implied by this generative DAG calls for just one realization of <span class="math inline">\(\theta\)</span> to be used in generating all 3 observations of <span class="math inline">\(x\)</span>. In other words, our recipe assumes there is just one “true” <span class="math inline">\(\theta\)</span> value and all observations are Bernoulli trials with the same <span class="math inline">\(\theta\)</span> value. The question we will soon answer computationally is “how to reallocate our plausibility among all possible”true” values of <span class="math inline">\(\theta\)</span> given that we have observed 3 observations of <span class="math inline">\(x\)</span>?”</p>
<p>More rigorous mathematical notation and definitions can be found in the lucid recommendations of Michael Betancourt. See his work <em>Towards a Principled Bayesian Workflow (Rstan)</em> for a more in-depth treatment of how generative models and prior distributions are only models of real-world processes. <a href="https://betanalpha.github.io/assets/case_studies/principled_bayesian_workflow.html" class="uri">https://betanalpha.github.io/assets/case_studies/principled_bayesian_workflow.html</a>. Additionally, Betancourt’s <em>Generative Modelling</em> (<a href="https://betanalpha.github.io/assets/case_studies/generative_modeling.html" class="uri">https://betanalpha.github.io/assets/case_studies/generative_modeling.html</a>) is excellent in explaining how models with narrative interpretations tell a set of stories on how data are generated. For us, we will combine our generative DAGs with observed data to refine our beliefs about which stories (i.e.&nbsp;which parameters) seem more plausible than others.</p>
</section>
</section>
<section id="computational-bayesian-inference-workflows" class="level2">
<h2 class="anchored" data-anchor-id="computational-bayesian-inference-workflows">Computational Bayesian inference workflows</h2>
<p>This section illustrates how to use the <code>causact</code> package to specify and run computational Bayesian inference workflows. The package is an easy-to-use, intuitive, and visual interface to <code>numpyro</code>. In fact, it automates the creation of <code>numpyro</code> code based on a user creating a generative DAG. <code>causact</code> advocates and enables generative DAGs to serve as a business analytics workflow (BAW) platform upon which to launch business discussions, create statistical models, and automate computational Bayesian inference.</p>
<section id="getting-started-with-dag_foo-functions" class="level3">
<h3 class="anchored" data-anchor-id="getting-started-with-dag_foo-functions">Getting started with <code>dag_foo()</code> functions</h3>
<p>In the code below, the two lines beginning with <code>dag_</code> output R list objects consisting of six data frames. Let’s not worry too much about the details, but notice that one of the data frames is for storing node information (i.e.&nbsp;<code>nodesDF</code>) and one for edge information (i.e.&nbsp;<code>edgesDF</code>).</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="do">## returns a list of data frames to store DAG info</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dag_create</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>$nodes_df
 [1] id         label      descr      data       rhs        child     
 [7] obs        rhsID      distr      auto_label auto_descr auto_data 
[13] dimID      auto_rhs  
&lt;0 rows&gt; (or 0-length row.names)

$edges_df
[1] id   from to   type
&lt;0 rows&gt; (or 0-length row.names)

$arg_df
[1] rhsID        argName      argType      argValue     argDimLabels
&lt;0 rows&gt; (or 0-length row.names)

$plate_index_df
[1] indexID          indexLabel       indexDescription indexDisplayName
[5] dataNode         rhs             
&lt;0 rows&gt; (or 0-length row.names)

$plate_node_df
[1] indexID nodeID 
&lt;0 rows&gt; (or 0-length row.names)

$dim_df
[1] dimID         nodeID        dimType       dimDataSource dimValue     
&lt;0 rows&gt; (or 0-length row.names)

attr(,"class")
[1] "causact_graph"</code></pre>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="do">## adds a node to the list with given description</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dag_create</span>() <span class="sc">%&gt;%</span> <span class="fu">dag_node</span>(<span class="st">"BernoulliRV"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>$nodes_df
  id label       descr data  rhs child   obs rhsID distr auto_label  auto_descr
1  1  &lt;NA&gt; BernoulliRV &lt;NA&gt; &lt;NA&gt;    NA FALSE    NA FALSE       BrRV BernoulliRV
  auto_data dimID auto_rhs   dec   det
1      &lt;NA&gt;    NA     &lt;NA&gt; FALSE FALSE

$edges_df
[1] id   from to   type
&lt;0 rows&gt; (or 0-length row.names)

$arg_df
[1] rhsID        argName      argType      argValue     argDimLabels
&lt;0 rows&gt; (or 0-length row.names)

$plate_index_df
[1] indexID          indexLabel       indexDescription indexDisplayName
[5] dataNode         rhs             
&lt;0 rows&gt; (or 0-length row.names)

$plate_node_df
[1] indexID nodeID 
&lt;0 rows&gt; (or 0-length row.names)

$dim_df
[1] dimID         nodeID        dimType       dimDataSource dimValue     
&lt;0 rows&gt; (or 0-length row.names)

attr(,"class")
[1] "causact_graph"</code></pre>
</div>
</div>
<p>The function dag_create() is used to create an empty list object that we will refer to as a <em>causact_graph</em>. Subsequently functions like <code>dag_node()</code> and <code>dag_edge()</code> will take a <em>causact_graph</em> object as input, modify them, and provide a <em>causact_graph</em> object as output. This feature allows for the chaining (i.e.&nbsp;using <code>%&gt;%</code>) of these functions to build up your observational model. Once done building with <code>dag_create()</code>, <code>dag_node()</code>, and <code>dag_edge()</code>, a call to the <code>dag_render()</code> function outputs a visual depiction of your <em>causact graph</em>.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dag_create</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dag_node</span>(<span class="st">"BernoulliRV"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dag_render</span>()   <span class="do">## visualize graph</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div class="grViz html-widget html-fill-item" id="htmlwidget-5a982514ce28ae593bde" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-5a982514ce28ae593bde">{"x":{"diagram":"digraph {\n\ngraph [layout = \"dot\",\n       outputorder = \"edgesfirst\",\n       bgcolor = \"white\",\n       labelloc = \"b\",\n       labeljust = \"r\"]\n\nnode [fontname = \"Helvetica\",\n      fontsize = \"10\",\n      shape = \"ellipse\",\n      fixedsize = \"false\",\n      width = \"0.9\",\n      style = \"filled\",\n      fillcolor = \"AliceBlue\",\n      color = \"gray20\",\n      fontcolor = \"black\",\n      height = \"0.5\",\n      margin = \"0.05,0.05\"]\n\nedge [fontname = \"Helvetica\",\n     fontsize = \"8\",\n     len = \"1.5\",\n     color = \"gray20\",\n     arrowsize = \"0.5\",\n     fontcolor = \"black\"]\n\n  \"1\" [label = \"BernoulliRV\nBrRV\", shape = \"ellipse\", peripheries = \"1\", fillcolor = \"aliceblue\", fontcolor = \"black\"] \n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="four-steps-to-creating-graphical-models" class="level3">
<h3 class="anchored" data-anchor-id="four-steps-to-creating-graphical-models">Four steps to creating graphical models</h3>
<p>Let’s use the <code>dag_foo()</code> functions to make a generative DAG with Bernoulli data, a uniform prior, and some observed data:</p>
<p><span class="math display">\[
\begin{aligned}X &amp;\sim \textrm{Bernoulli}(\theta) \\\theta &amp;\sim \textrm{uniform}(0,1)\end{aligned}
\]</span></p>
<p>Assume two successes and one failure such that:</p>
<p><span class="math display">\[
x_1 = 1, x_2 = 1, x_3 = 0
\]</span></p>
<p>The following code uses the <code>descr</code> and <code>label</code> arguments of the <code>dag_node()</code> function to, respectively, provide a long label for your random variable that is easily understood by business stakeholders and a short label that is more for notational/mathematical convenience:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dag_create</span>() <span class="sc">%&gt;%</span>  <span class="co"># just get one node to show</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dag_node</span>(<span class="at">descr =</span> <span class="st">"Cognition increases"</span>, <span class="at">label =</span> <span class="st">"x"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dag_render</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div class="grViz html-widget html-fill-item" id="htmlwidget-0f735d05eac75555269e" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-0f735d05eac75555269e">{"x":{"diagram":"digraph {\n\ngraph [layout = \"dot\",\n       outputorder = \"edgesfirst\",\n       bgcolor = \"white\",\n       labelloc = \"b\",\n       labeljust = \"r\"]\n\nnode [fontname = \"Helvetica\",\n      fontsize = \"10\",\n      shape = \"ellipse\",\n      fixedsize = \"false\",\n      width = \"0.9\",\n      style = \"filled\",\n      fillcolor = \"AliceBlue\",\n      color = \"gray20\",\n      fontcolor = \"black\",\n      height = \"0.5\",\n      margin = \"0.05,0.05\"]\n\nedge [fontname = \"Helvetica\",\n     fontsize = \"8\",\n     len = \"1.5\",\n     color = \"gray20\",\n     arrowsize = \"0.5\",\n     fontcolor = \"black\"]\n\n  \"1\" [label = \"Cognition increases\nx\", shape = \"ellipse\", peripheries = \"1\", fillcolor = \"aliceblue\", fontcolor = \"black\"] \n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>Since, we actually observe this node as data, we use the <code>data</code> argument of the <code>dag_node()</code> function to specify the observed values:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dag_create</span>() <span class="sc">%&gt;%</span>  <span class="co"># make it an observed node by adding data</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dag_node</span>(<span class="at">descr =</span> <span class="st">"Cognition increases"</span>, <span class="at">label =</span> <span class="st">"x"</span>, </span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">data =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dag_render</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div class="grViz html-widget html-fill-item" id="htmlwidget-efd07531f021030c44f5" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-efd07531f021030c44f5">{"x":{"diagram":"digraph {\n\ngraph [layout = \"dot\",\n       outputorder = \"edgesfirst\",\n       bgcolor = \"white\",\n       labelloc = \"b\",\n       labeljust = \"r\"]\n\nnode [fontname = \"Helvetica\",\n      fontsize = \"10\",\n      shape = \"ellipse\",\n      fixedsize = \"false\",\n      width = \"0.9\",\n      style = \"filled\",\n      fillcolor = \"AliceBlue\",\n      color = \"gray20\",\n      fontcolor = \"black\",\n      height = \"0.5\",\n      margin = \"0.05,0.05\"]\n\nedge [fontname = \"Helvetica\",\n     fontsize = \"8\",\n     len = \"1.5\",\n     color = \"gray20\",\n     arrowsize = \"0.5\",\n     fontcolor = \"black\"]\n\n  \"1\" [label = \"Cognition increases [3]\nx\", shape = \"ellipse\", peripheries = \"1\", fillcolor = \"cadetblue\", fontcolor = \"black\"] \n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>The node’s darker fill is automated because of the supplied observed data and the <code>[3]</code> means there are three observed realizations in the supplied data vector. You could also use a plate to represent the multiple realizations, but I recommend plate creation to be the last step in creating generative DAGs via the <code>causact</code> package.</p>
<p>One goal we often have is to take a sample of data and find plausible parameters within a distribution family (e.g.&nbsp;normal, gamma, etc.) governing how that data might have been generated - at its core, Bayesian inference is a search for plausible parameters of a specified generative DAG. To specify the distribution family governing the observed data, use the <code>rhs</code> argument of the <code>dag_node()</code> function.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p><code>rhs</code> stands for right-hand side. The <code>rhs</code> of a node is reserved for indicating how the node is generated as a function of its parent nodes’ values. Alternatively, when not used as a distribution specification, the <code>rhs</code> is an algebraic expression or other function of data converting parent node values into a realization of the node’s value.</p>
</div>
</div>
<p>There is an implicit assumption that all unknown variables will eventually be defined by parent nodes - the <code>causact</code> package will not check for this. In the case below, we are specifying a parameter <code>theta</code> that will need to eventually be added as a parent node.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dag_create</span>() <span class="sc">%&gt;%</span>  <span class="co"># specify data generating distribution</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dag_node</span>(<span class="at">descr =</span> <span class="st">"Cognition increases"</span>, <span class="at">label =</span> <span class="st">"x"</span>, </span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">rhs =</span> <span class="fu">bernoulli</span>(theta),  <span class="do">##add distribution </span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">data =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dag_render</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div class="grViz html-widget html-fill-item" id="htmlwidget-7ef2983315589fed18d6" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-7ef2983315589fed18d6">{"x":{"diagram":"digraph {\n\ngraph [layout = \"dot\",\n       outputorder = \"edgesfirst\",\n       bgcolor = \"white\",\n       labelloc = \"b\",\n       labeljust = \"r\"]\n\nnode [fontname = \"Helvetica\",\n      fontsize = \"10\",\n      shape = \"ellipse\",\n      fixedsize = \"false\",\n      width = \"0.9\",\n      style = \"filled\",\n      fillcolor = \"AliceBlue\",\n      color = \"gray20\",\n      fontcolor = \"black\",\n      height = \"0.5\",\n      margin = \"0.05,0.05\"]\n\nedge [fontname = \"Helvetica\",\n     fontsize = \"8\",\n     len = \"1.5\",\n     color = \"gray20\",\n     arrowsize = \"0.5\",\n     fontcolor = \"black\"]\n\n  \"1\" [label = \"Cognition increases [3]\nx ~ bernoulli(theta)\", shape = \"ellipse\", peripheries = \"1\", fillcolor = \"cadetblue\", fontcolor = \"black\"] \n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>Note, a random variable’s distribution must be part of <code>causact</code>. The full list of <code>causact</code> distributions can be found by running the following line:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>?causact<span class="sc">::</span>distributions</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>For each unknown argument remaining on the <code>rhs</code> of any nodes in your causact graph, one must eventually All unknown rhs arguments for nodes must be defined prior to running any Bayesain computations.define how the unknown argument can be generated. In our data node above, the only unknown argument on the <code>rhs</code> is <code>theta</code>. We define the generative model for <code>theta</code> by making an additional node representing its value:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dag_create</span>() <span class="sc">%&gt;%</span>  </span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dag_node</span>(<span class="at">descr =</span> <span class="st">"Cognition increases"</span>, </span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="st">"x"</span>,</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">rhs =</span> <span class="fu">bernoulli</span>(theta), <span class="co"># no quotation marks</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">data =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dag_node</span>(<span class="at">descr =</span> <span class="st">"Success probability"</span>, </span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="st">"theta"</span>,  <span class="co"># labels needs quotes</span></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>           <span class="at">rhs =</span> <span class="fu">uniform</span>(<span class="dv">0</span>,<span class="dv">1</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dag_render</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div class="grViz html-widget html-fill-item" id="htmlwidget-22a76f1d8b9e786d9d3f" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-22a76f1d8b9e786d9d3f">{"x":{"diagram":"digraph {\n\ngraph [layout = \"dot\",\n       outputorder = \"edgesfirst\",\n       bgcolor = \"white\",\n       labelloc = \"b\",\n       labeljust = \"r\"]\n\nnode [fontname = \"Helvetica\",\n      fontsize = \"10\",\n      shape = \"ellipse\",\n      fixedsize = \"false\",\n      width = \"0.9\",\n      style = \"filled\",\n      fillcolor = \"AliceBlue\",\n      color = \"gray20\",\n      fontcolor = \"black\",\n      height = \"0.5\",\n      margin = \"0.05,0.05\"]\n\nedge [fontname = \"Helvetica\",\n     fontsize = \"8\",\n     len = \"1.5\",\n     color = \"gray20\",\n     arrowsize = \"0.5\",\n     fontcolor = \"black\"]\n\n  \"1\" [label = \"Cognition increases [3]\nx ~ bernoulli(theta)\", shape = \"ellipse\", peripheries = \"1\", fillcolor = \"cadetblue\", fontcolor = \"black\"] \n  \"2\" [label = \"Success probability\ntheta ~ uniform(0,1)\", shape = \"ellipse\", peripheries = \"1\", fillcolor = \"aliceblue\", fontcolor = \"black\"] \n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>Notice, the parameters of the <code>rhs</code> distribution for <code>theta</code> are not unknown - they are actually constants (i.e.&nbsp;0 and 1) and hence, no additional parent nodes are required to be created. Take note that <code>theta</code> on the <code>rhs</code> for the <em>Cognition increases</em> node does not require quotes as it refers to an R object; specifically, this refers to the R object created by:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dag_node</span>(<span class="at">descr =</span> <span class="st">"Success probability"</span>, </span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">label =</span> <span class="st">"theta"</span>,  <span class="co"># label needs quotes</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">rhs =</span> <span class="fu">uniform</span>(<span class="dv">0</span>,<span class="dv">1</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>where the <code>theta</code> object is given its name by the <code>label = "theta"</code> argument; when creating node labels via this argument, quotes are typically required.</p>
<p>Without a link between <code>theta</code> and <code>x</code>, one is not creating a properly factorizable directed acyclic graph as is required for specifying a joint distribution. Using the <code>child</code> argument of <code>dag_node</code>, one can now create the required link between <code>theta</code> as a parent node and <code>theta</code> as an argument to the distribution of its child node <code>x</code>:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dag_create</span>() <span class="sc">%&gt;%</span>  <span class="co"># connect parent to child</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dag_node</span>(<span class="at">descr =</span> <span class="st">"Cognition increases"</span>, <span class="at">label =</span> <span class="st">"x"</span>,</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">rhs =</span> <span class="fu">bernoulli</span>(theta),</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">data =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dag_node</span>(<span class="at">descr =</span> <span class="st">"Success probability"</span>, <span class="at">label =</span> <span class="st">"theta"</span>,</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">rhs =</span> <span class="fu">uniform</span>(<span class="dv">0</span>,<span class="dv">1</span>),</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>           <span class="at">child =</span> <span class="st">"x"</span>) <span class="sc">%&gt;%</span>  <span class="do">## ADDED LINE TO CREATE EDGE</span></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dag_render</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div class="grViz html-widget html-fill-item" id="htmlwidget-e28ddcdfc64296f5794e" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-e28ddcdfc64296f5794e">{"x":{"diagram":"digraph {\n\ngraph [layout = \"dot\",\n       outputorder = \"edgesfirst\",\n       bgcolor = \"white\",\n       labelloc = \"b\",\n       labeljust = \"r\"]\n\nnode [fontname = \"Helvetica\",\n      fontsize = \"10\",\n      shape = \"ellipse\",\n      fixedsize = \"false\",\n      width = \"0.9\",\n      style = \"filled\",\n      fillcolor = \"AliceBlue\",\n      color = \"gray20\",\n      fontcolor = \"black\",\n      height = \"0.5\",\n      margin = \"0.05,0.05\"]\n\nedge [fontname = \"Helvetica\",\n     fontsize = \"8\",\n     len = \"1.5\",\n     color = \"gray20\",\n     arrowsize = \"0.5\",\n     fontcolor = \"black\"]\n\n  \"1\" [label = \"Cognition increases [3]\nx ~ bernoulli(theta)\", shape = \"ellipse\", peripheries = \"1\", fillcolor = \"cadetblue\", fontcolor = \"black\"] \n  \"2\" [label = \"Success probability\ntheta ~ uniform(0,1)\", shape = \"ellipse\", peripheries = \"1\", fillcolor = \"aliceblue\", fontcolor = \"black\"] \n\"2\"->\"1\" [style = \"solid\"] \n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>When using the child argument, please ensure the child was previously defined as a node. Generative DAGs are designed to be built from bottom-to-top reflecting the way a business analyst would create these DAGs. Note that computer code for Bayesian inference, like numpyro code, requires the exact opposite order - parent nodes get defined prior to their children. One way the causact package accelerates the BAW is by facilitating a bottom-up workflow that can be automatically translated to top-down computer code.</p>
</div>
</div>
<p>For more complicated modelling, repeat this process of adding parent nodes until there are no uncertain parameters on the right hand side of the top nodes.</p>
</section>
<section id="running-bayesian-inference-on-a-generative-dag" class="level3">
<h3 class="anchored" data-anchor-id="running-bayesian-inference-on-a-generative-dag">Running Bayesian inference on a generative DAG</h3>
<p>Now we use <code>dag_numpyro()</code> function to get a posterior distribution based solely on the <code>causact_graph</code> that we just made. A call to <code>dag_numpyro()</code> expects a <code>causact_graph</code> as the first argument, so make sure you are not passing the output of the <code>dag_render()</code> function by mistake. Use <code>dag_render()</code> to get a picture and <code>dag_numpyro()</code> for Bayesian inference - just do not mix them in the same chain of functions. The second argument of <code>dag_numpyro()</code> is the <code>mcmc</code> argument and its default value is <code>TRUE</code>. When <code>mcmc = FALSE</code>, <code>dag_numpyro(mcmc = FALSE)</code> gives a print-out of the <code>numpyro</code> code that would be run by <code>causact</code> to get a posterior without running the code. You can cut and paste this code into a new R-script if you wish and run it there (ESPECIALLY USEFUL FOR DEBUGGING WHEN YOU GET AN ERROR AT THIS STAGE). Alternatively and preferably, the <code>numpyro</code> code should run automatically in the background by setting <code>mcmc = TRUE</code> or simply omitting this argument because it is the default value. Usage is shown below:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># running Bayesian inference</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="co"># remove dag_render() and save graph object</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>graph <span class="ot">=</span> <span class="fu">dag_create</span>() <span class="sc">%&gt;%</span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dag_node</span>(<span class="at">descr =</span> <span class="st">"Cognition increases"</span>, </span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="st">"x"</span>,</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">rhs =</span> <span class="fu">bernoulli</span>(theta),</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>           <span class="at">data =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dag_node</span>(<span class="at">descr =</span> <span class="st">"Success probability"</span>, </span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="st">"theta"</span>,</span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>           <span class="at">rhs =</span> <span class="fu">uniform</span>(<span class="dv">0</span>,<span class="dv">1</span>),</span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>           <span class="at">child =</span> <span class="st">"x"</span>)</span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a><span class="co"># pass graph to dag_numpyro</span></span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a>draws <span class="ot">=</span> graph <span class="sc">%&gt;%</span> <span class="fu">dag_numpyro</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>After some time, during which <code>numpyro</code> computes our posterior Bayesian distribution, we get that distribution as representative sample in an object I typically name <code>draws</code> - a data frame of posterior draws that is now useful for computation and plotting. For a quick visual-check that all went well, pass the <code>draws</code> data frame to the <code>dagp_plot()</code> function to get a quick look at the credible (posterior) values of <code>theta</code>:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>draws <span class="sc">%&gt;%</span> <span class="fu">dagp_plot</span>()  <span class="co"># eyeball P(theta&gt;0.65)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="causact_files/figure-html/unnamed-chunk-29-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>the lighter fill indicates a 90% percentile interval where 5% of plausible values are excluded from the left- and right-sides of the colored interval. Consider this range your credilble values for <code>theta</code>; hence, our posterior belief is that <code>theta</code> is somewhere in the 27% to 90% range. The darker fill within the colored interval indicates a 10% percentile interval; hence, the most likely values of <code>theta</code> are centered around 60%. For more customized graphs, please use <code>bayesplot</code> or <code>ggplot2</code> with <code>ggdist</code> with <code>draws</code> as the input data.</p>
</section>
<section id="investigating-the-posterior-distribution" class="level3">
<h3 class="anchored" data-anchor-id="investigating-the-posterior-distribution">Investigating the posterior distribution</h3>
<p>The object we named <code>draws</code> is our posterior distribution after <code>numpyro</code> automated Bayes rule for us. The posterior distribution is expressed as a representative sample of all unobserved nodes/parameters; it is not a named probability distribution. Each row of <code>draws</code> is a single individual sample or realization of the posterior distribution. Each row is referred to as a <strong>draw</strong> from the posterior.</p>
<p>To see a representative sample of the posterior distribution, we access the R object, <code>draws</code>, created above. The <code>theta</code> column of <code>draws</code> contains our representative sample of the posterior distribution. In this case, that representative sample includes 4,000 samples of <code>theta</code>. Recall that our prior belief about <code>theta</code>, the probability of success, was uniformly distributed between 0 and 1 - all values equally likely. Now, after observing 2 successes and 1 failure, our plausibility beliefs should favor <span class="math inline">\(\theta\)</span> values away from 0 and 1 and more towards middle values as we learned both success and failure are possible; but we let Bayes rule (via <code>numpyro</code>) do this plausibility updating for us.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(draws)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">theta</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">0.3855</td>
</tr>
<tr class="even">
<td style="text-align: right;">0.5282</td>
</tr>
<tr class="odd">
<td style="text-align: right;">0.4598</td>
</tr>
<tr class="even">
<td style="text-align: right;">0.4707</td>
</tr>
<tr class="odd">
<td style="text-align: right;">0.4707</td>
</tr>
<tr class="even">
<td style="text-align: right;">0.8929</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Using <code>bayesplot</code>, we can visualize how plausibility was reallocated from our uniform prior of <span class="math inline">\(\theta\)</span> in light of the observed data; in other words, we can see the posterior distribution for <span class="math inline">\(\theta\)</span> after observing 2 out of 3 stores increase sales:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_areas</span>(draws)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="causact_files/figure-html/unnamed-chunk-31-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Notice how values of <span class="math inline">\(\theta\)</span> are no longer uniformly distributed; values from 50% to 75% are represented more frequently.</p>
<p>Some other takeaways from the plot regarding plausibility reallocation:</p>
<ul>
<li><p>Low values of <span class="math inline">\(\theta\)</span> are now deemed less plausible; two out of three successes is simply inconsistent with low values of <span class="math inline">\(\theta\)</span>.</p></li>
<li><p>Very high values of <span class="math inline">\(\theta\)</span> are less plausbile; one failure in three tries is not likely to occur if <span class="math inline">\(\theta\)</span> were to be super-high.</p></li>
<li><p>Our best guess of <span class="math inline">\(\theta\)</span> went from 0.5 (i.e.&nbsp;the mean of theta when uniformly distributed) to <code>mean(draws$theta) =</code> 0.60.</p></li>
<li><p>We are still very unsure about the “true” value of <span class="math inline">\(\theta\)</span> after only 3 observations. We can see this by looking at quantiles of the posterior distribution suggesting a 90% percentile interval from 0.25 to 0.91:</p></li>
</ul>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summarize_draws</span>(draws)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 12%">
<col style="width: 9%">
<col style="width: 9%">
<col style="width: 9%">
<col style="width: 9%">
<col style="width: 9%">
<col style="width: 9%">
<col style="width: 6%">
<col style="width: 12%">
<col style="width: 12%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">variable</th>
<th style="text-align: right;">mean</th>
<th style="text-align: right;">median</th>
<th style="text-align: right;">sd</th>
<th style="text-align: right;">mad</th>
<th style="text-align: right;">q5</th>
<th style="text-align: right;">q95</th>
<th style="text-align: right;">rhat</th>
<th style="text-align: right;">ess_bulk</th>
<th style="text-align: right;">ess_tail</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">theta</td>
<td style="text-align: right;">0.6064</td>
<td style="text-align: right;">0.6213</td>
<td style="text-align: right;">0.2002</td>
<td style="text-align: right;">0.2194</td>
<td style="text-align: right;">0.2503</td>
<td style="text-align: right;">0.9109</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1520</td>
<td style="text-align: right;">1964</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>This continued large band of uncertainty is a good thing. We only have three data points, we should not be very confident in our point estimate of <span class="math inline">\(\theta\)</span>. If we want a tighter interval of uncertainty, then we simply need to get more data.</p>
</section>
<section id="making-probabilistic-statements-with-indicator-functions" class="level3">
<h3 class="anchored" data-anchor-id="making-probabilistic-statements-with-indicator-functions">Making probabilistic statements with indicator functions</h3>
<p>With a representative sample of the posterior joint distribution available to us, namely <code>draws</code>, we can expand on the strategies of the “Joint Distributions Tell Us Everything” section to make probabilistic statements from representative samples. For example, we might be curious to know <span class="math inline">\(P(\theta \gt 50\%)\)</span>. Using indicator functions, simple functions that equal 1 when a criteria is met and 0 when it is not, we can get our estimate of <span class="math inline">\(P(\theta \gt 50\%)\)</span>:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="do">## estimate posterior probability that theta &gt; 50%</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>draws <span class="sc">%&gt;%</span></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">indicatorFlag =</span> </span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>           <span class="fu">ifelse</span>(theta <span class="sc">&gt;</span> <span class="fl">0.5</span>, <span class="cn">TRUE</span>, <span class="cn">FALSE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">pctOfThetaVals =</span> <span class="fu">mean</span>(indicatorFlag))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">pctOfThetaVals</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">0.7032</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>We would then state that “the probability that <span class="math inline">\(\theta\)</span> is greater than 50% is approximately 0.70”.</p>
<p>Similarly, we can answer more complicated queries. For example, what is the <span class="math inline">\(P(40\% \lt \theta \lt 50\%)\)</span>:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="do">## estimate posterior probability that 40% &lt; theta &lt; 60%</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>draws <span class="sc">%&gt;%</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">indicatorFlag =</span> </span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>           <span class="fu">ifelse</span>(theta <span class="sc">&gt;</span> <span class="fl">0.4</span> <span class="sc">&amp;</span> theta <span class="sc">&lt;</span> <span class="fl">0.6</span>, </span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>                  <span class="cn">TRUE</span>, <span class="cn">FALSE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">pctOfThetaVals =</span> <span class="fu">mean</span>(indicatorFlag))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">pctOfThetaVals</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">0.292</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p><strong>The power of this workflow cannot be overstated</strong> and you will use it frequently for making probabilistic statements. Statements that will come in handy when it is time to use data to inform decision making under uncertainty.</p>
<p>A more descriptive output, possibly used for plotting purposes, is shown here:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>draws <span class="sc">%&gt;%</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">indicatorFlag =</span> </span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>           <span class="fu">ifelse</span>(theta <span class="sc">&gt;</span> <span class="fl">0.5</span>,</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"theta &gt; 0.5"</span>,</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"theta &lt;= 0.5"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(indicatorFlag) <span class="sc">%&gt;%</span></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">countInstances =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">percentageOfInstances =</span> </span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>           countInstances <span class="sc">/</span> <span class="fu">sum</span>(countInstances))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">indicatorFlag</th>
<th style="text-align: right;">countInstances</th>
<th style="text-align: right;">percentageOfInstances</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">theta &lt;= 0.5</td>
<td style="text-align: right;">1187</td>
<td style="text-align: right;">0.2968</td>
</tr>
<tr class="even">
<td style="text-align: left;">theta &gt; 0.5</td>
<td style="text-align: right;">2813</td>
<td style="text-align: right;">0.7032</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Why does this work? Let’s delve into the math for a moment just to see why.</p>
<p>An indicator function, denoted <span class="math inline">\(1_A\)</span> maps all values of a representative sample <span class="math inline">\(X\)</span> to either 0 or 1 depending on whether the values satisfy criteria to be in some set we label as <span class="math inline">\(A\)</span>. For example, assume <span class="math inline">\(A = \{x \ge 0.5\}\)</span> is math set notation for all values in representative sample <span class="math inline">\(X\)</span> such that the draw satisfies <span class="math inline">\(x \ge 0.5\)</span>. Then, the formal definition of an indicator function, denoted <span class="math inline">\(1_A\)</span>, maps elements in <span class="math inline">\(X\)</span> to either 0 or 1 depending on whether they are in <span class="math inline">\(A\)</span>:</p>
<p><span class="math display">\[
1_{A} \equiv\begin{cases}  1, &amp; \textrm{if } x \in A\\  0, &amp; \textrm{if } x \notin A\end{cases}
\]</span></p>
<p>Now, for the key math trick, known as the <em>fundamental bridge</em>. The probability of an event is the expected value (i.e.&nbsp;mean) of its indicator random variable. Mathematically,</p>
<p><span class="math display">\[
P(A) = \mathbb{E}[1_{A}]
\]</span></p>
<p>which is true since <span class="math inline">\(\mathbb{E}[1_{A}] = 1 \times P(A) + 0 \times P(\bar{A}) = P(A)\)</span> where <span class="math inline">\(\bar A\)</span> denotes not in set <span class="math inline">\(A\)</span>. So, using this formula we can make probabilistic statements about a realization <span class="math inline">\(x\)</span> meeting the criteria to be in set <span class="math inline">\(A\)</span>. Assuming <span class="math inline">\(J\)</span> draws in our data frame, each draw labelled <span class="math inline">\(j\)</span>, then we estimate <span class="math inline">\(P(A)\)</span> by taking the average value of an indicator function over the <span class="math inline">\(J\)</span> draws:</p>
<p><span class="math display">\[
P(A) = \mathbb{E}[1_{A}] \approx \frac{1}{J} \sum_{j=1}^J 1_{x_j \in A}
\]</span></p>
<p>And despite the heavy math notation, your intuition can guide you in applying this formula. For example, imagine we have a representative sample of <span class="math inline">\(X = [1,4,3,2,5]\)</span> and we want to estimate <span class="math inline">\(P(X \ge 3)\)</span>. You could answer this just by looking and say <span class="math inline">\(\frac{3}{5}\)</span> or 3 out of 5 chances for <span class="math inline">\(x \ge 3\)</span>. Applying the formula, which we could easily do with code, is shown mathematically here:</p>
<p><span class="math display">\[
P(x \geq 3) = \mathbb{E}[1_{x \geq 3}] \approx \frac{1}{5} \sum_{j=1}^5 1_{x_j \geq 3} = \frac{1}{5} \times (0+1+1+0+1) = \frac{3}{5} = 0.6
\]</span></p>
<p>We have a probabilistic statement: “the probability that <span class="math inline">\(x\)</span> is greater than or equal to 3 is 0.6”.</p>
</section>
<section id="credit-card-example" class="level3">
<h3 class="anchored" data-anchor-id="credit-card-example">Credit card example</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>graph <span class="ot">=</span> <span class="fu">dag_create</span>() <span class="sc">%&gt;%</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dag_node</span>(<span class="st">"Get Card"</span>,<span class="st">"x"</span>,</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">rhs =</span> <span class="fu">bernoulli</span>(theta),</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">data =</span> carModelDF<span class="sc">$</span>getCard) <span class="sc">%&gt;%</span></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dag_node</span>(<span class="st">"Signup Probability"</span>,<span class="st">"theta"</span>,</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">rhs =</span> <span class="fu">uniform</span>(<span class="dv">0</span>,<span class="dv">1</span>),</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>           <span class="at">child =</span> <span class="st">"x"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dag_plate</span>(<span class="st">"Car Model"</span>, <span class="st">"y"</span>,  </span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">data =</span> carModelDF<span class="sc">$</span>carModel,  </span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">nodeLabels =</span> <span class="st">"theta"</span>, </span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>            <span class="at">addDataNode =</span> <span class="cn">TRUE</span>)  <span class="sc">%&gt;%</span></span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dag_plate</span>(<span class="st">"Observations"</span>, <span class="st">"i"</span>,</span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a>            <span class="at">nodeLabels =</span> <span class="fu">c</span>(<span class="st">"x"</span>,<span class="st">"y"</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>graph <span class="sc">%&gt;%</span> <span class="fu">dag_render</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div class="grViz html-widget html-fill-item" id="htmlwidget-54a4873249b169eb6149" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-54a4873249b169eb6149">{"x":{"diagram":"digraph {\n\ngraph [layout = \"dot\",\n       outputorder = \"edgesfirst\",\n       bgcolor = \"white\",\n       labelloc = \"b\",\n       labeljust = \"r\"]\n\nnode [fontname = \"Helvetica\",\n      fontsize = \"10\",\n      shape = \"ellipse\",\n      fixedsize = \"false\",\n      width = \"0.9\",\n      style = \"filled\",\n      fillcolor = \"AliceBlue\",\n      color = \"gray20\",\n      fontcolor = \"black\",\n      height = \"0.5\",\n      margin = \"0.05,0.05\"]\n\nedge [fontname = \"Helvetica\",\n     fontsize = \"8\",\n     len = \"1.5\",\n     color = \"gray20\",\n     arrowsize = \"0.5\",\n     fontcolor = \"black\"]\n\nsubgraph cluster1{\nlabel=\"Car Model y [4]\"\n  \"2\" [label = \"Signup Probability\ntheta ~ uniform(0,1)\", shape = \"ellipse\", peripheries = \"1\", fillcolor = \"aliceblue\", fontcolor = \"black\"] }\n\nsubgraph cluster2{\nlabel=\"Observations i [1000]\"\n  \"1\" [label = \"Get Card\nx ~ bernoulli(theta[y])\", shape = \"ellipse\", peripheries = \"1\", fillcolor = \"cadetblue\", fontcolor = \"black\"] \n  \"3\" [label = \"Car Model\ny\", shape = \"ellipse\", peripheries = \"1\", fillcolor = \"cadetblue\", fontcolor = \"black\"] }\n\n\"2\"->\"1\" [style = \"dashed\"] \n\"3\"->\"1\" [style = \"solid\"] \n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>draws <span class="ot">=</span> graph <span class="sc">%&gt;%</span> <span class="fu">dag_numpyro</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>draws <span class="sc">%&gt;%</span> <span class="fu">dagp_plot</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="causact_files/figure-html/unnamed-chunk-39-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>